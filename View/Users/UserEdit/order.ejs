<style>
    #cancelButton{
        width: 150px;
        background-color: red;
        box-shadow: rgba(14, 30, 37, 0.12) 0px 2px 4px 0px, rgba(14, 30, 37, 0.32) 0px 2px 16px 0px;
    }
    #cancelButton:hover{
        background-color: rgb(116, 0, 0);
    }
    #ViewButton{
        width: 150px;
        background-color: rgb(1, 220, 49);
        box-shadow: rgba(14, 30, 37, 0.12) 0px 2px 4px 0px, rgba(14, 30, 37, 0.32) 0px 2px 16px 0px;
    }
    #ViewButton:hover{
        width: 150px;
        background-color: rgb(0, 104, 22);
        box-shadow: rgba(14, 30, 37, 0.12) 0px 2px 4px 0px, rgba(14, 30, 37, 0.32) 0px 2px 16px 0px;
    }
    #returnBTN{
        width: 150px;
        background-color: rgb(1, 220, 49);
        box-shadow: rgba(14, 30, 37, 0.12) 0px 2px 4px 0px, rgba(14, 30, 37, 0.32) 0px 2px 16px 0px;
    }
    #returnBTN:hover{
        background-color: rgb(0, 123, 27);
    }
    .sidebar {
        position: sticky;
        top: 100px;
        background: #f8f8f8;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        margin-left: -50px;
        width: 350px;
        height: 470px;
    }
    /* Preloader CSS */
    #preloader {
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }
    .loader {
        border: 8px solid rgba(0, 0, 0, 0.1);
        border-radius: 50%;
        border-top: 8px solid #000000;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>
</head>
<body>
<!-- Preloader HTML -->
<div id="preloader">
    <div class="loader"></div>
</div>

<%- include('../layout/header.ejs') %>
<!--::header part start::-->
<header class="main_menu home_menu  navcolor" style="background-color: rgb(248, 248, 248);" >
    <div class="container" id="navv">
        <div class="row align-items-center justify-content-center">
            <div class="col-lg-12">
                <nav class="navbar navbar-expand-lg navbar-light">
                    <a class="navbar-brand" href="/home"> <img src="/img/logo.png" alt="logo"> </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse"
                        data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="menu_icon"><i class="fas fa-bars"></i></span>
                    </button>

                    <div class="collapse navbar-collapse main-menu-item" id="navbarSupportedContent">
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a class="nav-link" href="/home">Home</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/about">about</a>
                            </li>
                            <li class="nav-item ">
                                <a class="nav-link " href="/product">product</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/contact">Contact</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/wishlist">Wishlist</a>
                            </li>
                        </ul>
                    </div>
                    <div class="hearer_icon d-flex align-items-center">
                        <a id="search_1" href="javascript:void(0)"><i class="ti-search"></i></a>
                        <a href="/cart/cart">
                            <i class="flaticon-shopping-cart-black-shape"></i>
                        </a>
                    </div>
                    <div class="header_icon d-flex align-items-center">
                        <div class="dropdown">
                            <a class="dropdown-toggles" href="/home" role="button" id="profileDropdownTrigger" data-bs-toggle="dropdown" aria-expanded="false">
                                <img height="22px" style="margin-left: 20px;" src="/img/icons8-account-48.png" alt="Profile">
                            </a>
                                <ul class="dropdown-menu" aria-labelledby="profileDropdownTrigger">
                                    <li><a class="dropdown-item" href="/logout">Logout</a></li>
                                </ul>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </div>
    <div class="search_input" id="search_input_box">
        <div class="container ">
            <form class="d-flex justify-content-between search-inner">
                <input type="text" class="form-control" id="search_input" placeholder="Type here to search">
                <button type="submit" class="btn"></button>
                <span class="ti-close" id="close_search" title="Close Search"></span>
            </form>
        </div>
    </div>
</header>
<!-- Header part end-->
<!--================ Area =================-->
<div class="wide-container">
    <div class="container">
        <div class="sidebar">
            <% if(typeof userDatas != 'undefined'){ %>
                <h2>Welcome <span style="color: rgb(23, 102, 133);" ><%= userDatas?.name  %></span> </h2>
                <% } %>
            <div class="user-profile">
                
                <ul>
                    <li class="Hove"><a href="/user/profile">Edit Profile</a></li>
                    <li class="Hove" ><a href="/user/address">Edit Address</a></li>
                    <li class="Hove" ><a href="/user/password">Edit Password</a></li>
                    <li class="active Hove" ><a href="/user/order">Order History</a></li>
                    <li class="Hove" ><a href="/user/wallet">Wallet</a></li>
                </ul>
            </div>
        </div>
        <div class="col-lg-9">
        <div class="content">
            <div class="form-container">
                <h2>Order History</h2>
                <form>
                    <div class="form-group">
                        <% if (typeof Data !== 'undefined' && Data.length > 0) { %>
                            <% for (var i = 0; i < Data.length; i++) { %>
                                <% var product = Data[i]; %>
                                <div class="product-box" id="product-box-<%= i %>" style="box-shadow: rgba(0, 0, 0, 0.16) 0px 3px 6px, rgba(0, 0, 0, 0.23) 0px 3px 6px; border-radius: 10px; padding: 20px; position: relative;">
                                    <% if(product.paymentStatus) { %>
                                        <img src="/paid.png" alt="Paid" style="position: absolute; top: 10px; right: 10px; width: 50px; height: auto; z-index: 1;">
                                    <% }else{ %>
                                        <img src="/payment-pending.png" alt="NotPaid" style="position: absolute; top: 10px; right: 10px; width: 50px; height: auto; z-index: 1;">
                                    <% } %>   
                                    <% if(product.Status == 'Canceled'){ %>
                                        <div style="background-color:rgba(255, 0, 0, 0.315); border-radius: 10px; padding: 5px; margin-bottom: 10px;"><span style="margin-left: 20px;">Order Canceled</span></div>
                                    <% }else if (product.Status == 'Delivered'){ %>
                                        <div style="background-color:rgba(67, 191, 0, 0.315); border-radius: 10px; padding: 5px; margin-bottom: 10px;"><span style="margin-left: 20px;">Order Delivered</span></div>
                                    <% }else if(product.Status == 'Pending'){ %>
                                        <div style="background-color:rgba(201, 174, 0, 0.315); border-radius: 10px; padding: 5px; margin-bottom: 10px;"><span style="margin-left: 20px;">Order Pending</span></div>
                                    <% }else{%> 
                                        <div style="background-color:rgba(0, 127, 201, 0.315); border-radius: 10px; padding: 5px; margin-bottom: 10px;"><span style="margin-left: 20px;"><%= product.Status %></span></div>
                                    <% }%> 
                                    <div class="row align-items-center">
                                        <div class="col-md-3">
                                            <a href="/user/viewDetails?ID=<%= product.docID %>"><img src="/productImages/<%= product.image %>" alt="<%= product.image %>" style="width: 100%; border-radius: 10px;"></a>
                                        </div>
                                        <div class="col-md-6">
                                            <h5 style="color: rgb(0, 0, 0); margin-left: 10px;"><span style="color: #61a5fd;">Product Name : </span><%= product.productName %></h5>
                                            <h5 style="color: rgb(0, 0, 0); margin-left: 10px;"><span style="color: #3f72b5;">Product Total : </span>$<%= product.Total %></h5>
                                            <h5 style="color: rgb(0, 0, 0); margin-left: 10px;"><span style="color: #2F8886">Delivery Date : </span><%= product.deliveryDate %></h5>
                                            <h5 style="color: rgb(0, 0, 0); margin-left: 10px;"><span style="color: #111d16">Payment Method : </span><%= product.paymentMethod %></h5>
                                            <input id="quant" type="hidden" value="<%= product.quantity %>">  
                                            <input id="docID" type="hidden" value="<%= product.docID %>"> 
                                            <input id="paymentMethod" type="hidden" value="<%= product.paymentMethod %>">  
                                            <input id="totalCash" type="hidden" value="<%= product.Total %>"> 
                                        </div>
                                        <div class="col-md-3 text-right">
                                            <button type="button" class="btn btn-secondary" style="margin-right: 5px;" id="ViewButton">
                                                <a style="color: rgb(255, 255, 255); " href="/user/viewDetails?ID=<%= product.docID %>">View Details</a>
                                            </button>
                                            <br>
                                            <br>
                                            <% if(product.Status == 'Pending'){ %>
                                            <button type="button" class="cancelOrderBtn btn " id="cancelButton" >
                                                <a style="color: rgb(255, 255, 255);" href="<%= product.ID %>">Cancel Order</a>
                                            </button>
                                            <% } else if(product.Status == 'Delivered'){ %>
                                            <button type="button" id="returnBTN">
                                                <a style="color: rgb(255, 255, 255);" href="<%= product.ID %>">Return Product</a>
                                            </button>  
                                            <% } else if(product.Status == 'Canceled'){  %> 
                                                <button type="button" style="background-color: rgb(143, 0, 0);" disabled>
                                                    <a style="color: rgb(255, 255, 255);" href="#">Product Canceled</a>
                                                </button> 
                                            <% } %>   
                                        </div>
                                    </div>
                                </div>
                                <br>
                            <% } %>
                        <% } else { %>
                            <h4 style="color: red;">No Products Ordered</h4>
                        <% } %>
                    </div>
                    
                </form>
            </div>
        </div>
    </div>
    </div>
</div>
<!--================end =================-->
<!--::footer_part start::-->
<footer class="footer_part">
    <div class="footer_iner section_bg">
        <div class="container">
            <div class="row justify-content-between align-items-center">
                <div class="col-lg-8">
                    <div class="footer_menu">
                        <div class="footer_logo">
                            <a href="index.html"><img src="/img<a href="index.html"><img src="/img/logo.png" alt="#"></a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="social_icon">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-google-plus-g"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="copyright_part">
        <div class="container">
            <div class="row ">
                <div class="col-lg-12">    
                    <div class="copyright_text">
                        <P><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                         Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="ti-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
                         <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></P>
                        <div class="copyright_link">
                            <a href="#">Turms & Conditions</a>
                            <a href="#">FAQ</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>
<!--::footer_part end::-->

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<link rel="stylesheet" href="/node_modules/sweetalert2/dist/sweetalert2.min.css">
<script src="/node_modules/sweetalert2/dist/sweetalert2.all.min.js"></script>
<script>
const buttons = document.querySelectorAll('.cancelOrderBtn');

for (let i = 0; i < buttons.length; i++) {
    const button = buttons[i];
    button.addEventListener('click', function(event) {
        event.preventDefault();

        const quant = button.closest('.product-box').querySelector('#quant').getAttribute('value');
        const docID = button.closest('.product-box').querySelector('#docID').getAttribute('value');
        const paymentMethod = button.closest('.product-box').querySelector('#paymentMethod').getAttribute('value');
        const totalCash = button.closest('.product-box').querySelector('#totalCash').getAttribute('value');

        Swal.fire({
            title: 'Are you sure?',
            text: 'You won\'t be able to revert this!',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Yes, cancel it!'
        }).then((result) => {
            if (result.isConfirmed) {
                const linkUrl = button.querySelector('a').getAttribute('href');
                axios.post(`/user/cancelOrder?ID=${linkUrl}&quant=${quant}&docID=${docID}&paymentMethod=${paymentMethod}&totalCash=${totalCash}`)
                    .then(function(response) {
                        Swal.fire({
                            title: "Order Canceled",
                            text: "Your Order has been Canceled.",
                            icon: "success"
                        }).then((result) => {
                            if (result.isConfirmed) {
                                if (response.data.Done) {
                                    window.location.reload();
                                }
                            }
                        });
                    }).catch(function(error) {
                        console.log(error);
                    });
            }
        });
    });
}

const returnButtons = document.querySelectorAll('#returnBTN');

for (let i = 0; i < returnButtons.length; i++) {
    const returnButton = returnButtons[i];
    returnButton.addEventListener('click', function(event) {
        event.preventDefault();
        const quant = returnButton.closest('.product-box').querySelector('#quant').getAttribute('value');
        const docID = returnButton.closest('.product-box').querySelector('#docID').getAttribute('value');

        Swal.fire({
            title: 'Are you sure?',
            text: 'You won\'t be able to revert this!',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Yes, return it!'
        }).then((result) => {
            if (result.isConfirmed) {
                Swal.fire({
                    title: 'Return Reason',
                    input: 'textarea',
                    inputPlaceholder: 'Type your reason for return here...',
                    inputAttributes: {
                        'aria-label': 'Type your reason for return here'
                    },
                    showCancelButton: true,
                    confirmButtonText: 'Submit',
                    cancelButtonText: 'Cancel'
                }).then((reasonResult) => {
                    if (reasonResult.isConfirmed) {
                        const reason = encodeURIComponent(reasonResult.value);
                        const linkUrl = returnButton.querySelector('a').getAttribute('href');
                        axios.post(`/user/returnOrder?ID=${linkUrl}&docID=${docID}&reason=${reason}`)
                            .then(function(response) {
                                Swal.fire({
                                    title: "Request Sended",
                                    text: "Your product return request sended ",
                                    icon: "success"
                                }).then((result) => {
                                    if (result.isConfirmed) {
                                        if (response.data.Done) {
                                            window.location.reload();
                                        }
                                    }
                                });
                            }).catch(function(error) {
                                console.log(error);
                            });
                    }
                });
            }
        });
    });
}

window.addEventListener('load', function() {
    // Hide preloader once the page is fully loaded
    document.getElementById('preloader').style.display = 'none';
});
</script>
<!-- jquery plugins here-->
<script src="/js/jquery-1.12.1.min.js"></script>
<!-- popper js -->
<script src="/js/popper.min.js"></script>
<!-- bootstrap js -->
<script src="/js/bootstrap.min.js"></script>
<!-- easing js -->
<script src="/js/jquery.magnific-popup.js"></script>
<!-- swiper js -->
<script src="/js/swiper.min.js"></script>
<!-- swiper js -->
<script src="/js/mixitup.min.js"></script>
<!-- particles js -->
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/jquery.nice-select.min.js"></script>
<!-- slick js -->
<script src="/js/slick.min.js"></script>
<script src="/js/jquery.counterup.min.js"></script>
<script src="/js/waypoints.min.js"></script>
<script src="/js/contact.js"></script>
<script src="/js/jquery.ajaxchimp.min.js"></script>
<script src="/js/jquery.form.js"></script>
<script src="/js/jquery.validate.min.js"></script>
<script src="/js/mail-script.js"></script>
<!-- custom js -->
<script src="/js/custom.js"></script>
</body>
</html>